# conga-aem-dispatcher-flush

This role flushes AEM dispatcher caches of a
[CONGA](http://devops.wcm.io/conga/) role. It reads the dispatcher flush
targets from the configuration and triggers the `flush dispatcher`
handler of
[aem-dispatcher-flush](https://github.com/wcm-io-devops/ansible-aem-dispatcher-flush)


## Requirements

This role requires Ansible 2.0 or higher.

## Role Variables

Available variables are listed below, along with their default values:

        conga_aem_dispatcher_target_query: "*.*.flushTarget.url[]"

The jmespath query executed on the conga_config dict generated by
[conga-facts](https://github.com/wcm-io-devops/ansible-conga-facts) to determine
the flush targets for the current CONGA role.

## Dependencies

This role depends on the
[conga-facts](https://github.com/wcm-io-devops/ansible-conga-facts) role
for accessing the CONGA configuration model and
[aem-dispatcher-flush](https://github.com/wcm-io-devops/ansible-aem-dispatcher-flush)
for executing the flush.

## Example Playbook

Flushes the dispatcher caches for the roles aem-author and aem-publish.

```yaml
# Setup & Execute CONGA
- hosts: localhost
  roles:
    - {
        role: conga-maven,
        tags: conga,
        # only run when conga configuration was not generated before
        when: (conga_configuration_generated is undefined) or (conga_configuration_generated == "false")
      }

- hosts: "&{{ conga_environment }}:aem-author"
  vars:
    conga_node: aem-author
    conga_role_mapping: aem-cms
  roles:
    - conga-aem-dispatcher-flush

- hosts: "&{{ conga_environment }}:aem-publish"
  vars:
    conga_node: aem-publish
    conga_role_mapping: aem-cms
  roles:
    - conga-aem-dispatcher-flush
```

## License

Apache 2.0
